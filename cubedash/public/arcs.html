<!DOCTYPE html>
<html lang='en'>
  <head>
    <meta charset='utf-8'>
    <title>Cubedash</title>
    <script src="/d3.js"></script>
    <script src="/d3-tip.js"></script>
    <script src="/queue.js"></script>
    <script src='/jquery.js' type='text/javascript'></script>
    <script src='/bootstrap.js' type='text/javascript'></script>
    <link href='/bootstrap.css' rel='stylesheet' type='text/css'>
    <style type="text/css">

path.long {
  fill-rule: evenodd;
  fill: red;
  fill-opacity: .75;
  stroke: #666;
  stroke-width: 1.5px;
}
path.med {
  fill-rule: evenodd;
  fill: orange;
  fill-opacity: .5;
  stroke: #666;
  stroke-width: 1.5px;
}
path.short {
  fill-rule: evenodd;
  fill: yellow;
  fill-opacity: .25;
  stroke: #666;
  stroke-width: 1.5px;
}


text {
  font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
  font-size: 24px;
  font-weight: bold;
}
    </style> 
  </head>
  
  <body>
    
    <!-- Static navbar -->
    <div class="navbar navbar-default navbar-static-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Cubedash</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="/index.html">Event Types</a></li>
            <li><a href="/heatmap.html">Heat Map</a></li>
            <li><a href="/barchart.html">Bar Chart</a></li>
            <li class="active"><a href="/arcs.html">Arcs</a></li>
          </ul>
        </div>
      </div>
    </div>
    
    
    <div class='container' style='font: 12px sans-serif;'>
      <div class='row'>
        <div class='span12'>
          
          <div id="arc">
          </div>
          
          
<form>
  <label><input type="radio" name="dataset" value="apples" checked> Apples</label>
  <label><input type="radio" name="dataset" value="oranges"> Oranges</label>
</form>
          <div id="pie">
          </div>
          
          <div id="txt">
          </div>

          <button type="button" class="btn btn-default btn-lg" onclick="updateData()">
            <span class="glyphicon glyphicon-repeat"></span> Update
          </button>

        </div>
      </div>
    </div>
    
    <script type='text/javascript'>
      
      //http://bl.ocks.org/mbostock/5100636
      
  //http://bl.ocks.org/mbostock/1346410
  var width = 960,
    height = 500,
    radius = Math.min(width, height) / 2;
    

var color = d3.scale.category20();


// control the start/end points for the arc
// TBD what to do when > 1 ?
var scale = d3.scale.linear()
  .domain([0, 1]) //max load value
  .range([-90 * (Math.PI/180), 90 * (Math.PI/180)]); //deg to rad

var pie = d3.layout.pie()
    .value(function(d) { console.log(d); return d.value; })
    .startAngle(scale(0))
    .endAngle(scale(1))
    .sort(null);
    
var arc = d3.svg.arc()
    .innerRadius(radius - 100)
    .outerRadius(radius - 20);
    
    
var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height)
  .append("g")
    .attr("transform", "translate(" + width / 2 + "," + height / 2 + ")");
    
var txt = d3.select("#txt");
    
    

function updateData()
{
  d3.json("/event?expression=collectd(load)&limit=1", function(json) {

    var data = [];

    data.push({time: json[0].time, name: 'short', value: json[0].data.load.shortterm});
    data.push({time: json[0].time, name: 'med', value: json[0].data.load.midterm});
    data.push({time: json[0].time, name: 'long', value: json[0].data.load.longterm});

    console.log(data);
    
    // text display
    var p = txt.selectAll('p')
      .data(data);
      
    p.text(function(d) {
      return 'U ' + JSON.stringify(d);
    });
    
    p.enter()
      .append('p')
      .attr('id', function(d) {
        return d.name;
      })
      .text(function(d) {
        return JSON.stringify(d);
      });
      
    p.exit()
      .text(function(d) {
        return 'E ' + JSON.stringify(d);
      })
      .transition()
      .delay(2000)
      .remove();
        
        
    var path = svg.datum(data).selectAll("path")
        .data(pie);
        
    path.enter().append("path")
        .attr("fill", function(d, i) { return color(i); })
        .attr("d", arc)
        .each(function(d) { this._current = d; }); // store the initial angles
        
    path.exit().remove();
    
    path = path.data(pie); // compute the new angles
    path.transition().duration(750).attrTween("d", arcTween); // redraw the arcs
    

      
      
    
  });
}
  

updateData();

setInterval(updateData, 10000);



// Store the displayed angles in _current.
// Then, interpolate from _current to the new angles.
// During the transition, _current is updated in-place by d3.interpolate.
function arcTween(a) {
  var i = d3.interpolate(this._current, a);
  this._current = i(0);
  return function(t) {
    return arc(i(t));
  };
}
  

    </script>
  </body>
</html>
